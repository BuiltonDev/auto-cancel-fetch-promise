{"version":3,"file":"index.es.js","sources":["../src/smartFetch.js","../src/smartPromise.js","../src/index.js"],"sourcesContent":["const fetchQueries = {};\nconst AbortController = window.AbortController;\n\nfunction smartFetch(componentName, ...args) {\n  const controller = new AbortController();\n  if (!fetchQueries[componentName]) {\n    fetchQueries[componentName] = [];\n  }\n  fetchQueries[componentName].push(controller);\n  args[1] = args[1] ? args[1] : {};\n  args[1].signal = controller.signal;\n  return fetch(...args);\n}\n\nfunction abortFetches(componentName) {\n  if (fetchQueries[componentName]) {\n    fetchQueries[componentName].forEach(controller => {\n      controller.abort();\n    });\n    fetchQueries[componentName] = undefined;\n  }\n}\n\nexport { smartFetch, abortFetches };\n","import React from \"react\";\n\nconst promises = {};\n\nconst makeCancelable = (promise) => {\n  const cancelError = new Error('Promise has been canceled');\n  cancelError.type = 'promiseCanceled';\n\n  let rejectFn;\n  const wrappedPromise = new Promise((resolve, reject) => {\n    rejectFn = reject;\n    promise.then(resolve, reject);\n  });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      rejectFn(cancelError);\n    },\n  };\n};\n\nfunction smartPromise(componentName, promise) {\n  if (!promises[componentName]) {\n    promises[componentName] = [];\n  }\n  const newPromise = makeCancelable(promise);\n  promises[componentName].push(newPromise);\n  return newPromise.promise;\n}\n\nfunction abortPromises(componentName) {\n  if (promises[componentName]) {\n    promises[componentName].forEach(p => {\n      p.cancel();\n    });\n    promises[componentName] = undefined;\n  }\n}\n\nexport { smartPromise, abortPromises };\n","import React from \"react\";\nimport { smartFetch, abortFetches } from \"./smartFetch\";\nimport { abortPromises, smartPromise } from \"./smartPromise\";\n\nexport default WrappedComponent => {\n  class HOC extends React.Component {\n    constructor(props) {\n      super(props);\n      this.name = WrappedComponent.name;\n      this.fetch = (...args) => smartFetch(this.name, ...args);\n      this.promiseWrapper = promise => smartPromise(this.name, promise);\n    }\n    componentWillUnmount() {\n      abortFetches(this.name);\n      abortPromises(this.name);\n    }\n    render() {\n      return <WrappedComponent {...this.props} fetch={this.fetch} promiseWrapper={this.promiseWrapper}/>;\n    }\n  }\n\n  return HOC;\n};\n"],"names":["fetchQueries","AbortController","window","smartFetch","componentName","controller","push","args","signal","fetch","abortFetches","forEach","abort","undefined","promises","makeCancelable","promise","cancelError","Error","type","rejectFn","wrappedPromise","Promise","resolve","reject","then","smartPromise","newPromise","abortPromises","cancel","HOC","props","name","WrappedComponent","promiseWrapper","React","Component"],"mappings":";;AAAA,IAAMA,eAAe,EAArB;AACA,IAAMC,kBAAkBC,OAAOD,eAA/B;;AAEA,SAASE,UAAT,CAAoBC,aAApB,EAA4C;MACpCC,aAAa,IAAIJ,eAAJ,EAAnB;MACI,CAACD,aAAaI,aAAb,CAAL,EAAkC;iBACnBA,aAAb,IAA8B,EAA9B;;eAEWA,aAAb,EAA4BE,IAA5B,CAAiCD,UAAjC;;oCALoCE,IAAM;QAAA;;;OAMrC,CAAL,IAAUA,KAAK,CAAL,IAAUA,KAAK,CAAL,CAAV,GAAoB,EAA9B;OACK,CAAL,EAAQC,MAAR,GAAiBH,WAAWG,MAA5B;SACOC,uBAASF,IAAT,CAAP;;;AAGF,SAASG,YAAT,CAAsBN,aAAtB,EAAqC;MAC/BJ,aAAaI,aAAb,CAAJ,EAAiC;iBAClBA,aAAb,EAA4BO,OAA5B,CAAoC,sBAAc;iBACrCC,KAAX;KADF;iBAGaR,aAAb,IAA8BS,SAA9B;;;;ACjBJ,IAAMC,WAAW,EAAjB;;AAEA,IAAMC,iBAAiB,SAAjBA,cAAiB,CAACC,OAAD,EAAa;MAC5BC,cAAc,IAAIC,KAAJ,CAAU,2BAAV,CAApB;cACYC,IAAZ,GAAmB,iBAAnB;;MAEIC,iBAAJ;MACMC,iBAAiB,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;eAC3CA,MAAX;YACQC,IAAR,CAAaF,OAAb,EAAsBC,MAAtB;GAFqB,CAAvB;;SAKO;aACIH,cADJ;UAAA,oBAEI;eACEJ,WAAT;;GAHJ;CAVF;;AAkBA,SAASS,YAAT,CAAsBtB,aAAtB,EAAqCY,OAArC,EAA8C;MACxC,CAACF,SAASV,aAAT,CAAL,EAA8B;aACnBA,aAAT,IAA0B,EAA1B;;MAEIuB,aAAaZ,eAAeC,OAAf,CAAnB;WACSZ,aAAT,EAAwBE,IAAxB,CAA6BqB,UAA7B;SACOA,WAAWX,OAAlB;;;AAGF,SAASY,aAAT,CAAuBxB,aAAvB,EAAsC;MAChCU,SAASV,aAAT,CAAJ,EAA6B;aAClBA,aAAT,EAAwBO,OAAxB,CAAgC,aAAK;QACjCkB,MAAF;KADF;aAGSzB,aAAT,IAA0BS,SAA1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCJ,aAAe,4BAAoB;MAC3BiB,GAD2B;;;iBAEnBC,KAAZ,EAAmB;;;2GACXA,KADW;;YAEZC,IAAL,GAAYC,iBAAiBD,IAA7B;YACKvB,KAAL,GAAa;0CAAIF,IAAJ;cAAA;;;eAAaJ,6BAAW,MAAK6B,IAAhB,SAAyBzB,IAAzB,EAAb;OAAb;YACK2B,cAAL,GAAsB;eAAWR,aAAa,MAAKM,IAAlB,EAAwBhB,OAAxB,CAAX;OAAtB;;;;;;6CAEqB;qBACR,KAAKgB,IAAlB;sBACc,KAAKA,IAAnB;;;;+BAEO;eACA,oBAAC,gBAAD,eAAsB,KAAKD,KAA3B,IAAkC,OAAO,KAAKtB,KAA9C,EAAqD,gBAAgB,KAAKyB,cAA1E,IAAP;;;;IAZcC,MAAMC,SADS;;SAiB1BN,GAAP;CAjBF;;;;"}